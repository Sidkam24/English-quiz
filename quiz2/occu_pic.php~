<?php
$i=0;
$a = $_GET['name'];
$b = $_GET['time'];
$monkazu = $_GET['mon'];
$score = $_GET['score'];
if(($a != "")&&($b != "")){
$w = $a.":".$b.":".$monkazu.":".$score."\n";
}
$file = fopen("rank_occupic.data","a");
fwrite($file,$w);
fclose($file);
// $file2=fopen("rank.data","r");
$data_info = file("rank_occupic.data");
foreach ( $data_info as $value){
	$pieces = explode(":",$value);
	$time[$pieces[0]] = $pieces[1];
	$mon[$pieces[0]] = $pieces[2];
	$sco[$pieces[0]] = $pieces[3];
	asort($sco,SORT_NUMERIC);
	$data_merge = array_merge_recursive($sco,$mon,$time); //$scoを基準にしないとスコア順にならない。
}

echo "<html><h1>職業~イラスト~Ranking</h1>";
echo "<table border=\"1\"><tr align=\"center\"><td width=\"100px\">ランキング</td><td width=\"200px\">ニックネーム</td><td width=\"100px\">時間</td>
      <td width=\"100px\">問題数</td><td width=\"100px\">スコア</td></tr>";

$pre=-1;
$interval = 0;
$prev=null;
echo "スコアの小さい方がランキングが上位である。<br>";
echo "※　スコア　=　(時間)　×　(問題数)　で表すものとする。<br>";
// print_r($data_merge);
foreach ($data_merge as $key => $value){
	// $g=count($time);
	// if($value[$i] == $value[$i+1]){
	//   $i=$i-1;
	//  }


	if(floatval($prev) == floatval($value[0])) {
		$interval++;
	}
	else {
		$i++;
		$interval = 0;
	}
	$prev = $value[0];
	echo "<tr align=\"center\"><td>".$i."位"."</td><td>" . $key . "</td><td>" . $value[2] . " 秒"."</td><td>" . $value[1] . "問" . "</td><td>" . $value[0] . "</td></tr>";
	//スコアを基準にしたため、スコアと時間表示を逆にすることで帳尻合わせできる。　
	$i += $interval;
}
echo "</table></html>";
?>
